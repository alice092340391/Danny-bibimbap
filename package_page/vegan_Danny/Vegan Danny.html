<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品主頁</title>
    <style>
     /* 全局樣式 */
    
            @font-face {
                font-family: Lemon-Regular;
                src: url(Lemon-Regular.ttf) format("opentype");
            }
    
            *,
            *::after,
            *::before {
                box-sizing: border-box;
                margin: 0px;
            }
    
            a {
                text-decoration: none
            }
    
            a:hover {
                text-decoration: none
            }
    
            .html {
                font-size: 62.5%;
            }
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
    
            body {
                font-family: "Lemon", serif;
                font-weight: 400;
                font-style: normal;
                padding: 0;
                display: inline;
                background-attachment: fixed;
            }
    
            .container {
                width: 100%;
                max-width: 1520px;
                margin: auto;
                padding: 20px;
                margin-left: 0px;
                padding-left: 0px;
                margin-right: 0px;
                padding-right: 0px;
                padding-top: 0px;
                position: relative;  
                display: flex;
                align-items: flex-start;
    
            }
    
            
            #contents {
                width: 100%; /* 撐滿整個容器 */
                height:1900px;
                background: #1C4425;
                padding: 20px; /* 內邊距 */
                padding-top: 0px;
                padding-left: 0px;
                padding-right: 0px;
                
            }
    
            .main-header{
            height:50px;
    
            }
    
    
            .showcase-area {
                height: 138px;
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
    
            }
    
            .showcase-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                height: 315px;
                font-size: 1.4rem;
                font-weight: bold;
                margin-bottom: 829px;
            }
    
            .title {
    
                background-color: #333 ;
                background-size: cover; /* 確保背景圖片覆蓋整個區域 */
                color: #fff;
                margin: 0;
                font-size: 2rem;
                height: auto; /* 自適應高度 */
                padding: 10px 0; /* 內邊距確保文字有空間 */
                line-height: 35px;
                text-align: center;
                font-size: 30px;
                border-top-width: 20px;
                padding-top: 10px;
                border-top-width: 20px;
                padding-top: 10px;
                padding-left: 3px;
    
                }
    
    
    
            /* Menu Section */
                .middle  {
                    color: #fff;
                    display: flex;
                    align-items: center;
                    gap: 1rem; /* Space between buttons */
                    padding: 1rem;
                    position: fixed;
                    top: 25px;
                    left: 47%;
                    transform: translateX(-49%);
                    z-index: 1000;
                    width: 100%;
                    justify-content: space-around;
                    position: absolute;
                    }
                
                    .carousel-container {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 1rem;
                    justify-content: center;
                    padding: 2rem 0;
                    padding-top: 0px;
    
                }
                .carousel-item {
                    width: 100%;
                    max-width: 200px;
                    text-align: center;
                    overflow-y: auto; /* 開啟垂直滾動條 */
                    scroll-behavior: smooth; /* 平滑滾動效果 */
                    -webkit-overflow-scrolling: touch; /* 啟用移動裝置上的平滑滾動 */
                }
    
                    .carousel-container::-webkit-scrollbar {
                display: none; /* 隱藏滾動條（適用於 Chrome、Safari） */
                }  
    
                .carousel-item img {
                    width: 100%;
                    height: auto;
                    border-radius: 10px;
                }
    
                .rounded-icon-btn {
                    background-color: transparent; /* 無背景色 */
                    border: 2px solid #fff;        /* 白色邊框 */
                    border-radius: 15px;           /* 圓角 */
                    color: #fff;                   /* 圖示顏色 */
                    width:253px;                 /* 按鈕寬度 */ 
                    height: 290.2px;               /* 按鈕高度 */ 
                    margin-top: 20px;
                    margin-left: 76px;
                    margin-right: 75px;                /* 按鈕高度 */
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;               /* 點擊效果 */
                    font-size: 1.5em;              /* 圖示大小 */
                    display: flex;
                    flex-direction: column;
                    align-items: center;
            }
    
                .rounded-icon-btn img {
                width: 120px;                   /* 圖片寬度佔滿按鈕 */
                height: 120px;                  /* 圖片高度佔滿按鈕 */
                border-radius: 15px;           /* 圖片圓角 */
    
            }
        
            #cart-modal,
                #checkout-modal {
                display: none;
                position: absolute;
                z-index: 999;
                /* 設置較高的 z-index 確保模態框覆蓋所有內容 */
                left: 50%;
                top: 15%;
                transform: translate(-50%);/* 只水平置中，不再垂直置中 */
                width: 360px;
                /* 模態框寬度 */
                height: 400px;
                /* 高度根據內容調整 */
                background-color: white;
                /* 背景顏色 */
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
                /* 加入陰影 */
                padding: 20px;
                /* 內邊距 */
                border-radius: 8px;
                /* 邊角圓滑 */
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.5);
                padding-top: 60px;
    
    
            }
    
    
                /* Modal Styles */
                .modal-content {
                    background-color: #fefefe;
                    margin: auto;
                    padding: 10px;
                    border: 1px solid #888;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                }
    
                .modal-overlay {
                    display: none;
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.5);
                    z-index: 998;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 28px;
                    font-weight: bold;
                }
    
                .close:hover,
                .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
    
                .cart-item {
                margin-bottom: 10px;
                color: black;
            }
    
                .cart-items-container {
                    max-height: 200px;
                    /* 限制高度以便滾動 */
                    overflow-y: auto;
                    /* 允許垂直滾動 */
                    margin-bottom: 10px;
                    /* 提供一些底部間距 */
                }
    
                .remove-button {
                    color: red;
                    cursor: pointer;
                }
    
                .button {
                    position: absolute;
                    background-color: #FCCB29;
                    border-radius: 10px;
                    font-weight: 900;
                    padding: 10px 20px;
                    border: none;
                    cursor: pointer;
                    display: block;
                    margin-bottom: 10px; 
                    top: 10px; /* 調整按鈕的位置 */  
                    left: 10px; /* 調整按鈕的位置 */  
                    z-index: 0; /* 設定 z-index，確保在長方形後面 */
                }  
    
                
                /* Notification Styles */
                #notification {
                    display: none;
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background-color: #28a745;
                    color: white;
                    padding: 10px;
                    border-radius: 5px;
                    z-index: 1000;
                }
    
                .options-container {
                margin-left: 20px;
                /* Add space between the interactive container and the options */
                }
    
                button {
                    border-radius: 10px;
                    font-weight: 900;
                    padding: 10px 20px;
                    border: none;
                    cursor: pointer;
                    display: block;
                    /* 確保按鈕顯示 */
                    /* 保證按鈕位於前面 */
                    margin-bottom: 10px;
                    background-color: #FCCB29;
                    COLOR: #FFF;
                    BORDER-COLOR: #FFF;
                    border: 2px solid #fff
    
                }
    
    
            .cart-wrap {  
                position: fixed;  
                background-size: cover;  
                bottom: 0; /* 固定在螢幕底部 */  
                left: 0;  
                width: 100%; /* 讓寬度滿版 */  
                background-color: #333;  
                color: white;  
                text-align: center;  
                display: flex;  
                justify-content: flex-end; /* 右对齐 */  
                align-items: flex-start; /* 向上对齐 */  
                padding: 10px 20px; /* 預設內邊距 */  
                z-index: 1;  
                flex-direction: column; /* 改为垂直排列 */  
            }  
    
    
                #checkout-total {  
                width: 100%; /* 确保宽度适应 */  
                text-align: left; /* 强制靠左 */
            }  
    
            .button-group {  
                display: flex; /* 使用flex排列按钮 */  
                flex-direction: column; /* 垂直排列按钮 */  
                align-items: flex-end; /* 右对齐按钮 */  
                margin-top: 10px; /* 按钮之间的间距 */  
                margin-top: 0px;
            }  
    
            .cart-button{
    
                margin: 5px; /* 按钮之间的间距 */  
                padding: 15px 0; /* 按钮内边距，确保按钮高度一致 */  
                width: 200px; /* 固定宽度，以确保按钮尺寸一致 */  
                background-color: yellow; /* 按钮背景颜色 */  
                border: none; /* 去掉边框 */  
                border-radius: 5px; /* 圆角按钮 */  
                cursor: pointer; /* 鼠标悬停为手型 */  
                font-size: 16px; /* 按钮字体大小 */  
                text-align: center; /* 确保文本居中 */  
    
                }
        
    
            .cart-button:hover {  
                background-color: #f0c040; /* 悬停效果 */  
            }   
    
    
    
    
    
            
    
                .footer {
                text-align: center;
                font-size: 1.8rem;
                padding: 1.6rem;
                font-weight: 500;
                color: #fff;
                background: #014e2a;
                bottom: 0;
                width: 352px;
                border: solid 2px;
                left: 650px;
                border-bottom-width: 3px;
                border-right-width: 0px;
                border-left-width: 0px;
                }
    
                .interactive-container {
                display: inline-block;
                vertical-align: top;
                width: 50%; /* Adjust width if necessary */
                padding: 20px;
                box-sizing: border-box;
                width: 140px;
                border-radius: 15px;
                background-color: #fff;
                overflow: hidden;
                z-index: 1000;
                margin: 20px;
                margin-left: 5px;
                z-index: 1;
                /* 設置較低的 z-index，確保模態框能覆蓋它 */
                margin-left: 10px;
                padding-left: 0px;
            }
    
            .result.options-container {
                display: inline-block;
                vertical-align: top;
                width: 40%; /* Adjust width to match the layout */
                padding: 20px;
                margin-left: 5%;
                box-sizing: border-box;
                color: #fff;
                border-radius: 8px;
                width: 190px;
                margin-left: 0px;
            }
    
            .option-container {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                cursor: pointer;
                padding: 15px;
                border-bottom: 1px solid #eee;
                position: relative;
                transition: background-color 0.3s ease, box-shadow 0.3s ease;
                background-color: #ffffff;
                width: 200px;
                /* 固定寬度，例如 200px */
                box-sizing: border-box;
                /* 確保內邊距和邊框不影響寬度 */
            }
    
            .option-container input[type="radio"] {
                margin-right: 10px;
                appearance: none;
                -webkit-appearance: none;
                border: 2px solid #ccc;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                margin-right: 15px;
                outline: none;
                cursor: pointer;
            }
    
            .option-container input[type="radio"]:checked {
                    border-color: #ffd700;
                    background-color: #ffd700;
                }
    
                .option-container label {
                    cursor: pointer;
                    color: #333;
                    transition: color 0.3s ease;
                }
    
                .subtext {
                    position: absolute;
                    right: 10px;
                    color: #888;
                    font-size: 14px;
                    transition: color 0.3s ease;
                } 
                .result {
                    margin-top: 10px;
                    padding: 10px;
                    border-radius: 5px;
                    display: block;
                    width: 220px;
                    /* 設定結果區的寬度 */
                    margin-left: 10px;
    
    
                }
    
                .option-container .highlight {
                    position: absolute;
                    left: 0;
                    width: 5px;
                    height: 100%;
                    background-color: transparent;
                }
    
                .option-container input[type="radio"]:checked~.highlight {
                    background-color: #ffd700;
                }
    
                .option-container.active {
                    transform: translateY(-5px);
                    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
                    background-color: #000;
                    border: 2px solid #ffd700;
                    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
                    /* Raised effect */
                }
    
                .option-container.active label,
                .option-container.active .subtext {
                    color: #fff;
                }
    
                product-description {
                    position: relative;
                    /* 使 .product-description 成為定位參考 */
                    width: 352px;
                    /* 根據需要設置寬度 */
                    height: 1100px;
                    /* 根據需要設置高度 */
                    text-align: left;
                    color: #fff;
                    font-size: 18px;
                    background-color: #1c4425;
                    padding: 15px;
                    border-radius: 10px;
                    margin-bottom: 15px;
                    margin-top: 20px;
                    /* 根據需要設置 */
                    top: 200px;
                    padding-left: 0px;
                    padding-right: 0px;
                }
    
                .product-description h2 {
                    font-size: 25px;
                    margin: 0 0 10px;
                }
    
                .product-description p {
                    margin: 0;
                }
    
    
    
        
                /* Button styles */
    
                .btn-50,
                .btn-50 *,
                .btn-50 :after,
                .btn-50:after,
                .btn-50:before {
                    border: 0 solid;
                    box-sizing: border-box;
                }
    
                .btn-50 {
                    -webkit-tap-highlight-color: transparent;
                    background-color: #000;
                    border-width: 3px;
                    background-image: none;
                    color: #fff;
                    cursor: pointer;
                    font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
                        Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif,
                        Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
                    font-size: 100%;
                    line-height: 1.5;
                    margin: 0;
                    padding: 0;
                }
    
                .btn-50:disabled {
                    cursor: default;
                }
    
                .btn-50:-moz-focusring {
                    outline: auto;
                }
    
                .btn-50 svg {
                    display: block;
                }
    
                .btn-50 [hidden] {
                    display: none;
                }
                .btn-50 {
                    background: #FCCB29;
                    color: #ffffff;
                    border-radius: 10px; /* Rounded corners */
                    padding: 15px 20px;
                    font-weight: bold;
                    text-transform: uppercase;
                    text-align: center;
                    text-decoration: none; /* Remove underline */
                    flex: 1; /* Buttons evenly share space */
                    max-width: 200px; /* Prevent buttons from getting too large */
                    transition: all 0.3s ease;
                    box-sizing: border-box;
                    display: block;
                    font-weight: 900;
                    perspective: 800px;
                    position: relative;
                    transition: transform 0.2s;
                    padding-left: 20px;
                    padding-bottom: 20px;
                    padding-top: 10px;
                    height: 70.8px;
                    padding-right: 20px;
                    font-size: 14px;
                }
    
                .btn-50:hover {
                    background-color: #e0a900;
                    transform: scale(1.05);
                    transform: rotateX(38deg) translateY(7px);
                }
    
                /* Responsive Design */
                @media (max-width: 768px) {
                    .menu {
                        gap: 0.5rem; /* Reduce space between buttons for smaller screens */
                    }
    
                    .btn-50 {
                        padding: 10px 15px;
                    }
    
                    .cart-wrap {
                    padding: 10px 15px; /* 調整內邊距 */
                    font-size: 14px; /* 字體大小調整 */
                    }
                    .interactive-container, .result.options-container {
                    
                    
                    margin: 0;
    
                    }
    
                }
    
                @media (min-width: 600px) {
                    .cart-wrap {
                        flex-direction: column; /* 縱向排列，以便在窄螢幕上更易讀 */
                        padding: 15px; /* 調整內邊距 */
                        text-align: center; /* 確保文字置中對齊 */
                    }
                    .interactive-container, .result.options-container {
                    
                    
                    margin: 0;
    
                    }
                    
                }
    
                @media (max-width: 480px) {
                    .btn-50 {
                        padding: 8px 12px; /* Adjust padding for smaller screens */
                    }
    
                    .cart-wrap {
                    padding: 8px 10px; /* 調整內邊距 */
                    font-size: 12px; /* 字體大小調整 */
                    flex-direction: column; /* 讓內容垂直排列 */
                    align-items: center; /* 中央對齊 */
                    }
    
                    .interactive-container, .result.options-container {
                    
                    
                    margin: 0;
    
                    }
    
                }
     </style>
 </head>
 <body>
    <div class="container">

        <main id="contents">

            <header class="main-header">
                <section class="showcase-area" id="showcase">
                    <h1 class="title">Danny bibimbap </h1>
                </section>
            </header>
            <!-- Buttons -->
            <div class="middle ">
                <h2 id="table-number" style="font-size:20px;">桌號:</h2>
                <a href="../../free_choice_page/free-choice-page.html" class="btn-50" style="top: 60px;right:14px;left: -30;">自由配<br>BYOB</a>
                <a href="../package-page.html" class="btn-50" style="top: 60px; right: 26px; left: -10px;">套餐<br>Sets</a>
                <a href="../../drinks_page/drinks-page.html"class="btn-50" style="top: 60px; right:10px; left: -10;padding-right: 12px;">飲料<br>Drinks</a>
            </div>

            <hr color="#fff" size="2"  width="100%"  style="margin-top: 150px;">  

            <h2 style=" color:#fff;margin-top:20px;margin-left: 10px;margin-bottom: 20px;text-align:center;">素食丹尼 $230</h2>
            <div style="text-align: center;">  
                <img style="width:150px;height:150px;margin-bottom: 10px;"src="img/Poke-Go-Lanai-Go2.png" alt="豪華丹尼圖示">
                <p style=" font-size: 19px; color: #fff;text-align:center;margin-bottom: 10px;">主要內容物為<br>豆腐</p>
                <p style=" font-size: 19px; color: #fff;text-align:center"> 367 kcal</p>
                <hr color="#fff" size="2" width="100%" style="margin-top:10px;">
            </div>

            <!-- 互動選項容器 -->
            <div style="margin-top: 20px;margin-left: 10px;">
                <div class="interactive-container">
                    <div class="option-container" onclick="selectOption('base', this)">
                        <input type="radio" name="option" id="base">
                        <label for="base">基底</label>
                        <div class="highlight"></div>
                    </div>
                    <div class="option-container" onclick="selectOption('protein', this)">
                        <input type="radio" name="option" id="protein">
                        <label for="protein">蛋白質</label>
                        <div class="highlight"></div>
                    </div>
                    <div class="option-container" onclick="selectOption('condiment', this)">
                        <input type="radio" name="option" id="condiment">
                        <label for="condiment">佐料</label>
                        <div class="highlight"></div>
                    </div>
                    <div class="option-container" onclick="selectOption('sauce', this)">
                        <input type="radio" name="option" id="sauce">
                        <label for="sauce">醬料</label>
                        <div class="highlight"></div>
                    </div>
                    <div class="option-container active" onclick="selectOption('sprinkle', this)">
                        <input type="radio" name="option" id="sprinkle">
                        <label for="sprinkle">灑料</label>
                        <div class="highlight"></div>
                    </div>
                </div>
                <div id="result" class="result options-container" >
                    <strong>請選擇sprinkle：</strong><br>
                    <label><input type="checkbox" value="黑芝麻" onchange="updateSelection('sprinkle', this)"> 黑芝麻</label><br>
                    <label><input type="checkbox" value="核桐麥" onchange="updateSelection('sprinkle', this)"> 核桐麥</label><br>
                    <label><input type="checkbox" value="七味粉" onchange="updateSelection('sprinkle', this)"> 七味粉</label><br>
                    <label><input type="checkbox" value="海苔絲" onchange="updateSelection('sprinkle', this)"> 海苔絲</label>
                </div>
                <div id="notification" style="display: none;">商品已加入購物車！</div>
            </div>

            <div class="cart-wrap">
                <div id="checkout-total">
                    <p style="margin-top: 10px; color:#fff; font-size:25px; left: 10px; top:0px;">總金額: $<span id="product-price">120</span></p>
                    <div class="button-group">  
                        <button id="add-to-cart" onclick="addToCart()" style="margin-bottom:10px;margin-left: 210px;">加入購物車</button>
                        <button onclick="viewCart()" style="margin-left: 210px;margin-bottom: 17px">查看購物車</button>
                    </div>
                </div>
            </div>

            <!-- 背景遮罩（只保留一個） -->
            <div id="modal-overlay" class="modal-overlay"></div>

            <!-- 購物車模態框（只保留一個） -->
            <div id="cart-modal" style="display: none; left: 827px;">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('cart')">×</span>
                    <h2 style="color: #000;">購物車</h2>
                    <div id="cart-items"></div>
                    <div id="initial-amount" style="color: #000;">初始金額: $<span id="initial-amount-value">120</span></div>
                    <button onclick="openCheckout()">結帳</button>
                    <button onclick="removeAllItems()">清空購物車</button>
                </div>
            </div>

            <!-- 結帳模態框 -->
            <div id="checkout-modal" style="left: 827px; display: none;">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('checkout')">×</span>
                    <h2>結帳</h2>
                    <div id="checkout-items"></div>
                    <button onclick="confirmCheckout()">確認訂購</button>
                </div>
            </div>

            <!-- 菜單資料容器（避免 fetchMenuData 出錯） -->
            <div id="menu-container" style="display:none;"></div>

        </main>
    </div>

    <script>
        // 頁面載入時顯示桌號
        document.addEventListener('DOMContentLoaded', function() {
            const tableNumber = localStorage.getItem('tableNumber') || '1';
            document.getElementById('table-number').textContent = '桌號:' + tableNumber;
        });

        // ...existing code...
        // 修正重複 addToCart、main 巢狀、id 重複、index 未宣告、totalPrice 累加問題

        let totalPrice = 120;  // 定義初始價格
        const selectedItems = {  
            "base": [],
            "protein": [],
            "condiment": [],
            "sauce": [],
            "sprinkle": []
        };

        const extraCosts = {  
            "base": [
                { "id": 1, "name": "生菜", "extraPrice": 0 },
                { "id": 2, "name": "紫米", "extraPrice": 0 },
                { "id": 3, "name": "各半", "extraPrice": 0 }
            ],
            "protein": [
                { "id": 4, "name": "無蛋白質", "extraPrice": 0 },
                { "id": 5, "name": "鮭魚(+70)", "extraPrice": 70 },
                { "id": 6, "name": "豆腐(+50)", "extraPrice": 50 },
                { "id": 7, "name": "章魚(+70)", "extraPrice": 70 },
                { "id": 8, "name": "鮪魚(+70)", "extraPrice": 70 }
            ],
            "condiment": [
                { "id": 9, "name": "毛豆仁", "extraPrice": 0 },
                { "id": 10, "name": "花椰菜", "extraPrice": 0 },
                { "id": 11, "name": "水煮蛋", "extraPrice": 0 },
                { "id": 12, "name": "鷹嘴豆", "extraPrice": 0 },
                { "id": 13, "name": "小番茄", "extraPrice": 0 },
                { "id": 14, "name": "秋葵", "extraPrice": 0 },
                { "id": 15, "name": "玉米粒", "extraPrice": 0 },
                { "id": 16, "name": "小黃瓜", "extraPrice": 0 },
                { "id": 17, "name": "地瓜泥", "extraPrice": 0 },
                { "id": 18, "name": "紫薯泥(+20)", "extraPrice": 20 },
                { "id": 19, "name": "海帶絲", "extraPrice": 0 },
                { "id": 20, "name": "洋蔥", "extraPrice": 0 },
                { "id": 21, "name": "玉子燒", "extraPrice": 0 },
                { "id": 22, "name": "杏鮑菇", "extraPrice": 0 },
                { "id": 23, "name": "黑豆", "extraPrice": 0 },
                { "id": 24, "name": "玉米筍", "extraPrice": 0 },
                { "id": 25, "name": "黃金泡菜", "extraPrice": 0 }
            ],
            "sauce": [
                { "id": 26, "name": "辣美乃滋", "extraPrice": 0 },
                { "id": 27, "name": "墨西哥辣醬", "extraPrice": 0 },
                { "id": 28, "name": "和風胡麻醬", "extraPrice": 0 },
                { "id": 29, "name": "柚香甜醬油", "extraPrice": 0 }
            ],
            "sprinkle": [
                { "id": 30, "name": "黑芝麻", "extraPrice": 0 },
                { "id": 31, "name": "核桐麥", "extraPrice": 0 },
                { "id": 32, "name": "七味粉", "extraPrice": 0 },
                { "id": 33, "name": "海苔絲", "extraPrice": 0 }
            ]
        };

        function selectOption(optionType) {
            let choices = [];
            const resultDiv = document.getElementById('result');
            if (optionType === 'base') {
                choices = ["生菜", "紫米", "各半"];
            } else if (optionType === 'protein') {
                choices = ["無蛋白質", "鮭魚(+70)", "豆腐(+50)", "章魚(+70)", "鮪魚(+70)"];
            } else if (optionType === 'condiment') {
                choices = ['毛豆仁', '花椰菜', '水煮蛋', '鷹嘴豆', '小番茄', '秋葵', '玉米粒', '小黃瓜', '地瓜泥', '紫薯泥 (+20元)', '海帶絲', '洋蔥', '玉子燒', '杏鮑菇', '黑豆', '玉米筍', '黃金泡菜'];
            } else if (optionType === 'sauce') {
                choices = ["辣美乃滋", "墨西哥辣醬", "和風胡麻醬", "柚香甜醬油"];
            } else if (optionType === 'sprinkle') {
                choices = ["黑芝麻", "核桐麥", "七味粉", "海苔絲"];
            }
            resultDiv.innerHTML = `<strong>請選擇${optionType}：</strong><br>` + extraCosts[optionType].map(choice => {
                return `<label><input type="checkbox" value="${choice.id}" onchange="updateSelection('${optionType}', this)"> ${choice.name}</label>`;
            }).join('<br>');
        }

        function clearCheckboxes() {
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            for (const key in selectedItems) {
                selectedItems[key] = [];
            }
            updatePrice();
        }

        function updateSelection(optionType, checkbox) {
            const maxSelections = {
                base: 1,
                protein: 1,
                condiment: 5,
                sauce: 1,
                sprinkle: 2
            };
            if (checkbox.checked && selectedItems[optionType].length >= maxSelections[optionType]) {
                alert(`最多只能選擇${maxSelections[optionType]}個${optionType}`);
                checkbox.checked = false;
                return;
            }
            if (checkbox.checked) {
                selectedItems[optionType].push(checkbox.value);
            } else {
                const index = selectedItems[optionType].indexOf(checkbox.value);
                if (index > -1) selectedItems[optionType].splice(index, 1);
            }
            updatePrice();
        }

        function showNotification(msg) {
            const notification = document.getElementById('notification');
            notification.innerHTML = msg || '商品已加入購物車！';
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }

        function updatePrice() {
            totalPrice = 120; // 每次重算都歸零
            for (const option in selectedItems) {
                selectedItems[option].forEach(item => {
                    const extraCostsPrice = extraCosts[option].filter((extraCostsItem)=>extraCostsItem.id == item);
                    if (extraCostsPrice.length){
                        totalPrice += extraCostsPrice[0].extraPrice;
                    }
                });
            }
            document.getElementById('product-price').textContent = `${totalPrice}`;
        }

        function addToCart() {
            let cart = [];
            if (localStorage.getItem('cart')){
                cart = JSON.parse(localStorage.getItem('cart'));
            }
            cart.push({id: cart.length+1, product: JSON.parse(JSON.stringify(selectedItems)), price: totalPrice, amount: 1});
            localStorage.setItem('cart', JSON.stringify(cart));
            for (const key in selectedItems) {
                selectedItems[key] = [];
            }
            updatePrice();
            showNotification("商品已加入購物車！");
        }

        function viewCart() {
            let cart = [];
            if (localStorage.getItem('cart')){
                cart = JSON.parse(localStorage.getItem('cart'));
            }
            const cartItemsDiv = document.getElementById('cart-items');
            if (cart.length) {
                let itemStr = '<div>';
                cart.forEach((item)=>{
                    const id = item.id;
                    let prod = item.product;
                    for (const element in prod) {
                    prod[element].forEach((chooseItem)=>{
                        // 找到對應名稱
                        const found = extraCosts[element].find(opt => opt.id == chooseItem);
                        itemStr += (found ? found.name : chooseItem) + ' ';
                    });
                }
                    itemStr += `<span class="remove-button" onclick="removeCartItem('${id}')">移除</span><br>`;
                });
                itemStr += '</div>';
                cartItemsDiv.innerHTML = itemStr;
            } else {
                cartItemsDiv.innerHTML = '還沒有加入商品';
            }
            openModal('cart');
        }

        function removeCartItem(cartId) {
            let cart = [];
            if (localStorage.getItem('cart')){
                cart = JSON.parse(localStorage.getItem('cart'));
            }
            cart = cart.filter(item=>item.id != cartId);
            localStorage.setItem('cart', JSON.stringify(cart));
            viewCart();
        }

        function removeAllItems() {
            localStorage.removeItem('cart');
            for (const type in selectedItems) {
                selectedItems[type] = [];
            }
            updatePrice();
            viewCart();
        }

        function openCheckout() {
            const checkoutItemsDiv = document.getElementById('checkout-items');
            checkoutItemsDiv.innerHTML = '';
            let cart = [];
            if (localStorage.getItem('cart')){
                cart = JSON.parse(localStorage.getItem('cart'));
            }
            if (cart.length) {
                cart.forEach((item, idx) => {
                    checkoutItemsDiv.innerHTML += `<div>商品${idx+1}：<br>`;
                    for (const type in item.product) {
                        if (item.product[type].length > 0) {
                            const items = item.product[type].map(i => {
                                const found = extraCosts[type].find(opt => opt.id == i);
                                return `<div>${found ? found.name : i}</div>`;
                            }).join('');
                            checkoutItemsDiv.innerHTML += `<strong>${type}：</strong>${items}<br>`;
                        }
                    }
                    checkoutItemsDiv.innerHTML += `<div>金額：$${item.price}</div><hr>`;
                });
            } else {
                checkoutItemsDiv.innerHTML = '購物車為空';
            }
            openModal('checkout');
        }

        function confirmCheckout() {
            alert('結帳成功！');
            removeAllItems();
            closeModal('cart');
            closeModal('checkout');
        }

        function openModal(modalId) {
            document.getElementById('modal-overlay').style.display = 'block';
            const modal = document.getElementById(modalId + '-modal');
            if (modal) modal.style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById('modal-overlay').style.display = 'none';
            const modal = document.getElementById(modalId + '-modal');
            if (modal) modal.style.display = 'none';
        }

        document.querySelectorAll('.option-container').forEach(option => {
            option.addEventListener('click', function () {
                document.querySelectorAll('.option-container').forEach(item => item.classList.remove('active'));
                this.classList.add('active');
                const radioInput = this.querySelector('input[type="radio"]');
                if (radioInput) {
                    radioInput.checked = true;
                }
            });
        });

        // 避免 fetchMenuData 出錯
        function displayMenuData(data) {
            const menuContainer = document.getElementById('menu-container');
            if (!menuContainer) return;
            menuContainer.innerHTML = '';
            data.SetMeals.forEach(menu => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                menuItem.innerHTML = `
                    <h2>${menu.MenuName}</h2>
                    <img src="${menu.Image}" alt="${menu.MenuName}">
                    <p>價格: ${menu.Price} 元</p>
                    <p>蛋白質: ${menu.ProteinChoices.join(', ')}</p>
                    <p>配菜: ${menu.SideChoices.join(', ')}</p>
                    <p>醬料: ${menu.SauceChoices.join(', ')}</p>
                    <p>灑料: ${menu.SprinkleChoices.join(', ')}</p>
                `;
                menuContainer.appendChild(menuItem);
            });
        }
        async function fetchMenuData() {
            try {
                const response = await fetch("http://localhost:3000/ouo/get-menu-data.php");
                if (!response.ok) {
                    throw new Error(`HTTP 錯誤！狀態: ${response.status}`);
                }
                const data = await response.json();
                displayMenuData(data);
            } catch (error) {
                // 不顯示 alert，避免干擾
                console.error("無法載入菜單數據：", error);
            }
        }
        document.addEventListener('DOMContentLoaded', fetchMenuData);

    </script>
</body>
</html>
