<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品主頁</title>
    <style>
         /* 全局樣式 */
 
         @font-face {
             font-family: Lemon-Regular;
             src: url(Lemon-Regular.ttf) format("opentype");
         }
 
         *,
         *::after,
         *::before {
             box-sizing: border-box;
             margin: 0px;
         }
 
         a {
             text-decoration: none
         }
 
         a:hover {
             text-decoration: none
         }
 
         .html {
             font-size: 62.5%;
         }
        * {
             margin: 0;
             padding: 0;
             box-sizing: border-box;
         }
 
         body {
             font-family: "Lemon", serif;
             font-weight: 400;
             font-style: normal;
             padding: 0;
             display: inline;
             background-attachment: fixed;
         }
 
         .container {
             width: 100%;
             max-width: 1520px;
             margin: auto;
             padding: 20px;
             margin-left: 0px;
             padding-left: 0px;
             margin-right: 0px;
             padding-right: 0px;
             padding-top: 0px;
             position: relative;  
             display: flex;
             align-items: flex-start;
 
         }
 
         
         #contents {
             width: 100%; /* 撐滿整個容器 */
             height:1900px;
             background: #1C4425;
             padding: 20px; /* 內邊距 */
             padding-top: 0px;
             padding-left: 0px;
             padding-right: 0px;
             
         }
 
           .main-header{
           height:50px;
 
         }
 
 
         .showcase-area {
             height: 138px;
             background-size: cover;
             background-position: center;
             background-repeat: no-repeat;
 
         }
 
         .showcase-container {
             display: flex;
             flex-direction: column;
             align-items: center;
             height: 315px;
             font-size: 1.4rem;
             font-weight: bold;
             margin-bottom: 829px;
         }
 
         .title {
 
             background-color: #333 ;
             background-size: cover; /* 確保背景圖片覆蓋整個區域 */
             color: #fff;
             margin: 0;
             font-size: 2rem;
             height: auto; /* 自適應高度 */
             padding: 10px 0; /* 內邊距確保文字有空間 */
             line-height: 35px;
             text-align: center;
             font-size: 30px;
             border-top-width: 20px;
             padding-top: 10px;
             border-top-width: 20px;
             padding-top: 10px;
             padding-left: 3px;
 
             }
 
 
 
         /* Menu Section */
             .middle  {
                 color: #fff;
                 display: flex;
                 align-items: center;
                 gap: 1rem; /* Space between buttons */
                 padding: 1rem;
                 position: fixed;
                 top: 25px;
                 left: 47%;
                 transform: translateX(-49%);
                 z-index: 1000;
                 width: 100%;
                 justify-content: space-around;
                 position: absolute;
                 }
             
                 .carousel-container {
                 display: flex;
                 flex-wrap: wrap;
                 gap: 1rem;
                 justify-content: center;
                 padding: 2rem 0;
                 padding-top: 0px;
 
             }
             .carousel-item {
                 width: 100%;
                 max-width: 200px;
                 text-align: center;
                 overflow-y: auto; /* 開啟垂直滾動條 */
                 scroll-behavior: smooth; /* 平滑滾動效果 */
                 -webkit-overflow-scrolling: touch; /* 啟用移動裝置上的平滑滾動 */
             }
 
                 .carousel-container::-webkit-scrollbar {
             display: none; /* 隱藏滾動條（適用於 Chrome、Safari） */
             }  
 
             .carousel-item img {
                 width: 100%;
                 height: auto;
                 border-radius: 10px;
             }
 
             .rounded-icon-btn {
                 background-color: transparent; /* 無背景色 */
                 border: 2px solid #fff;        /* 白色邊框 */
                 border-radius: 15px;           /* 圓角 */
                 color: #fff;                   /* 圖示顏色 */
                 width:253px;                 /* 按鈕寬度 */ 
                 height: 290.2px;               /* 按鈕高度 */ 
                 margin-top: 20px;
                 margin-left: 76px;
                 margin-right: 75px;                /* 按鈕高度 */
                 align-items: center;
                 justify-content: center;
                 cursor: pointer;               /* 點擊效果 */
                 font-size: 1.5em;              /* 圖示大小 */
                 display: flex;
                 flex-direction: column;
                 align-items: center;
         }
 
             .rounded-icon-btn img {
             width: 120px;                   /* 圖片寬度佔滿按鈕 */
             height: 120px;                  /* 圖片高度佔滿按鈕 */
             border-radius: 15px;           /* 圖片圓角 */
 
         }
    
         #cart-modal,
             #checkout-modal {
             display: none;
             position: absolute;
             z-index: 999;
             /* 設置較高的 z-index 確保模態框覆蓋所有內容 */
             left: 50%;
             top: 15%;
             transform: translate(-50%);/* 只水平置中，不再垂直置中 */
             width: 360px;
             /* 模態框寬度 */
             height: 400px;
             /* 高度根據內容調整 */
             background-color: white;
             /* 背景顏色 */
             box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
             /* 加入陰影 */
             padding: 20px;
             /* 內邊距 */
             border-radius: 8px;
             /* 邊角圓滑 */
             overflow: auto;
             background-color: rgba(0, 0, 0, 0.5);
             padding-top: 60px;
 
 
         }
 
 
             /* Modal Styles */
             .modal-content {
                 background-color: #fefefe;
                 margin: auto;
                 padding: 10px;
                 border: 1px solid #888;
                 width: 100%;
                 height: 100%;
                 overflow: auto;
             }
 
             .modal-overlay {
                 display: none;
                 position: fixed;
                 top: 0;
                 left: 0;
                 width: 100%;
                 height: 100%;
                 background-color: rgba(0, 0, 0, 0.5);
                 z-index: 998;
             }
 
             .close {
                 color: #aaa;
                 float: right;
                 font-size: 28px;
                 font-weight: bold;
             }
 
             .close:hover,
             .close:focus {
                 color: black;
                 text-decoration: none;
                 cursor: pointer;
             }
 
 
             .cart-item {
             margin-bottom: 10px;
             color: black;
         }
 
             .cart-items-container {
                 max-height: 200px;
                 /* 限制高度以便滾動 */
                 overflow-y: auto;
                 /* 允許垂直滾動 */
                 margin-bottom: 10px;
                 /* 提供一些底部間距 */
             }
 
             .remove-button {
                 color: red;
                 cursor: pointer;
             }
 
             .button {
                 position: absolute;
                 background-color: #FCCB29;
                 border-radius: 10px;
                 font-weight: 900;
                 padding: 10px 20px;
                 border: none;
                 cursor: pointer;
                 display: block;
                 margin-bottom: 10px; 
                 top: 10px; /* 調整按鈕的位置 */  
                 left: 10px; /* 調整按鈕的位置 */  
                 z-index: 0; /* 設定 z-index，確保在長方形後面 */
             }  
 
              
             /* Notification Styles */
             #notification {
                 display: none;
                 position: fixed;
                 top: 20px;
                 right: 20px;
                 background-color: #28a745;
                 color: white;
                 padding: 10px;
                 border-radius: 5px;
                 z-index: 1000;
             }
 
             .options-container {
             margin-left: 20px;
             /* Add space between the interactive container and the options */
             }
 
             button {
                 border-radius: 10px;
                 font-weight: 900;
                 padding: 10px 20px;
                 border: none;
                 cursor: pointer;
                 display: block;
                 /* 確保按鈕顯示 */
                 /* 保證按鈕位於前面 */
                 margin-bottom: 10px;
                 background-color: #FCCB29;
                 COLOR: #FFF;
                 BORDER-COLOR: #FFF;
                 border: 2px solid #fff
 
             }
 
 
         .cart-wrap {  
             position: fixed;  
             background-size: cover;  
             bottom: 0; /* 固定在螢幕底部 */  
             left: 0;  
             width: 100%; /* 讓寬度滿版 */  
             background-color: #333;  
             color: white;  
             text-align: center;  
             display: flex;  
             justify-content: flex-end; /* 右对齐 */  
             align-items: flex-start; /* 向上对齐 */  
             padding: 10px 20px; /* 預設內邊距 */  
             z-index: 1;  
             flex-direction: column; /* 改为垂直排列 */  
        }  
 
 
             #checkout-total {  
             width: 100%; /* 确保宽度适应 */  
             text-align: left; /* 强制靠左 */
         }  
 
         .button-group {  
             display: flex; /* 使用flex排列按钮 */  
             flex-direction: column; /* 垂直排列按钮 */  
             align-items: flex-end; /* 右对齐按钮 */  
             margin-top: 10px; /* 按钮之间的间距 */  
             margin-top: 0px;
         }  
 
         .cart-button{
 
             margin: 5px; /* 按钮之间的间距 */  
             padding: 15px 0; /* 按钮内边距，确保按钮高度一致 */  
             width: 200px; /* 固定宽度，以确保按钮尺寸一致 */  
             background-color: yellow; /* 按钮背景颜色 */  
             border: none; /* 去掉边框 */  
             border-radius: 5px; /* 圆角按钮 */  
             cursor: pointer; /* 鼠标悬停为手型 */  
             font-size: 16px; /* 按钮字体大小 */  
             text-align: center; /* 确保文本居中 */  
 
             }
     
 
         .cart-button:hover {  
             background-color: #f0c040; /* 悬停效果 */  
         }   
 
 
 
 
 
        
 
             .footer {
             text-align: center;
             font-size: 1.8rem;
             padding: 1.6rem;
             font-weight: 500;
             color: #fff;
             background: #014e2a;
             bottom: 0;
             width: 352px;
             border: solid 2px;
             left: 650px;
             border-bottom-width: 3px;
             border-right-width: 0px;
             border-left-width: 0px;
             }
 
             .interactive-container {
             display: inline-block;
             vertical-align: top;
             width: 50%; /* Adjust width if necessary */
             padding: 20px;
             box-sizing: border-box;
             width: 140px;
             border-radius: 15px;
             background-color: #fff;
             overflow: hidden;
             z-index: 1000;
             margin: 20px;
             margin-left: 5px;
             z-index: 1;
             /* 設置較低的 z-index，確保模態框能覆蓋它 */
             margin-left: 10px;
             padding-left: 0px;
         }
 
         .result.options-container {
             display: inline-block;
             vertical-align: top;
             width: 40%; /* Adjust width to match the layout */
             padding: 20px;
             margin-left: 5%;
             box-sizing: border-box;
             color: #fff;
             border-radius: 8px;
             width: 190px;
             margin-left: 0px;
         }
 
         .option-container {
             display: flex;
             align-items: center;
             margin-bottom: 10px;
             cursor: pointer;
             padding: 15px;
             border-bottom: 1px solid #eee;
             position: relative;
             transition: background-color 0.3s ease, box-shadow 0.3s ease;
             background-color: #ffffff;
             width: 200px;
             /* 固定寬度，例如 200px */
             box-sizing: border-box;
             /* 確保內邊距和邊框不影響寬度 */
         }
 
          .option-container input[type="radio"] {
             margin-right: 10px;
             appearance: none;
             -webkit-appearance: none;
             border: 2px solid #ccc;
             width: 20px;
             height: 20px;
             border-radius: 50%;
             margin-right: 15px;
             outline: none;
             cursor: pointer;
         }
 
         .option-container input[type="radio"]:checked {
                 border-color: #ffd700;
                 background-color: #ffd700;
             }
 
             .option-container label {
                 cursor: pointer;
                 color: #333;
                 transition: color 0.3s ease;
             }
 
             .subtext {
                 position: absolute;
                 right: 10px;
                 color: #888;
                 font-size: 14px;
                 transition: color 0.3s ease;
             } 
             .result {
                 margin-top: 10px;
                 padding: 10px;
                 border-radius: 5px;
                 display: block;
                 width: 220px;
                 /* 設定結果區的寬度 */
                 margin-left: 10px;
 
 
             }
 
             .option-container .highlight {
                 position: absolute;
                 left: 0;
                 width: 5px;
                 height: 100%;
                 background-color: transparent;
             }
 
             .option-container input[type="radio"]:checked~.highlight {
                 background-color: #ffd700;
             }
 
             .option-container.active {
                 transform: translateY(-5px);
                 box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
                 background-color: #000;
                 border: 2px solid #ffd700;
                 box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
                 /* Raised effect */
             }
 
             .option-container.active label,
             .option-container.active .subtext {
                 color: #fff;
             }
 
             product-description {
                 position: relative;
                 /* 使 .product-description 成為定位參考 */
                 width: 352px;
                 /* 根據需要設置寬度 */
                 height: 1100px;
                 /* 根據需要設置高度 */
                 text-align: left;
                 color: #fff;
                 font-size: 18px;
                 background-color: #1c4425;
                 padding: 15px;
                 border-radius: 10px;
                 margin-bottom: 15px;
                 margin-top: 20px;
                 /* 根據需要設置 */
                 top: 200px;
                 padding-left: 0px;
                 padding-right: 0px;
             }
 
             .product-description h2 {
                 font-size: 25px;
                 margin: 0 0 10px;
             }
 
             .product-description p {
                 margin: 0;
             }
 
 
 
      
             /* Button styles */
 
             .btn-50,
             .btn-50 *,
             .btn-50 :after,
             .btn-50:after,
             .btn-50:before {
                 border: 0 solid;
                 box-sizing: border-box;
             }
 
             .btn-50 {
                 -webkit-tap-highlight-color: transparent;
                 background-color: #000;
                 border-width: 3px;
                 background-image: none;
                 color: #fff;
                 cursor: pointer;
                 font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
                     Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif,
                     Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
                 font-size: 100%;
                 line-height: 1.5;
                 margin: 0;
                 padding: 0;
             }
 
             .btn-50:disabled {
                 cursor: default;
             }
 
             .btn-50:-moz-focusring {
                 outline: auto;
             }
 
             .btn-50 svg {
                 display: block;
             }
 
             .btn-50 [hidden] {
                 display: none;
             }
             .btn-50 {
                 background: #FCCB29;
                 color: #ffffff;
                 border-radius: 10px; /* Rounded corners */
                 padding: 15px 20px;
                 font-weight: bold;
                 text-transform: uppercase;
                 text-align: center;
                 text-decoration: none; /* Remove underline */
                 flex: 1; /* Buttons evenly share space */
                 max-width: 200px; /* Prevent buttons from getting too large */
                 transition: all 0.3s ease;
                 box-sizing: border-box;
                 display: block;
                 font-weight: 900;
                 perspective: 800px;
                 position: relative;
                 transition: transform 0.2s;
                 padding-left: 20px;
                 padding-bottom: 20px;
                 padding-top: 10px;
                 height: 70.8px;
                 padding-right: 20px;
                 font-size: 14px;
             }
 
             .btn-50:hover {
                 background-color: #e0a900;
                 transform: scale(1.05);
                 transform: rotateX(38deg) translateY(7px);
             }
 
             /* Responsive Design */
             @media (max-width: 768px) {
                 .menu {
                     gap: 0.5rem; /* Reduce space between buttons for smaller screens */
                 }
 
                 .btn-50 {
                     padding: 10px 15px;
                 }
 
                 .cart-wrap {
                 padding: 10px 15px; /* 調整內邊距 */
                 font-size: 14px; /* 字體大小調整 */
                 }
                 .interactive-container, .result.options-container {
                
                
                 margin: 0;
 
                 }
 
             }
 
             @media (min-width: 600px) {
                  .cart-wrap {
                     flex-direction: column; /* 縱向排列，以便在窄螢幕上更易讀 */
                     padding: 15px; /* 調整內邊距 */
                     text-align: center; /* 確保文字置中對齊 */
                 }
                 .interactive-container, .result.options-container {
                
                
                margin: 0;
 
                }
                
             }
 
             @media (max-width: 480px) {
                 .btn-50 {
                     padding: 8px 12px; /* Adjust padding for smaller screens */
                 }
 
                 .cart-wrap {
                 padding: 8px 10px; /* 調整內邊距 */
                 font-size: 12px; /* 字體大小調整 */
                 flex-direction: column; /* 讓內容垂直排列 */
                 align-items: center; /* 中央對齊 */
                }
 
                .interactive-container, .result.options-container {
                
                
                margin: 0;
 
                }
 
             }
    </style>
</head>

<html>

<body>
    <div class="container">

        <main id="contents">
    
            <header class="main-header">
                <section class="showcase-area" id="showcase">
                    <h1 class="title">Danny bibimbap </h1>
    
            </header>
        <!-- Buttons -->
        <div class="middle ">
            <h2 style="font-size:20px;">桌號:1</h2>
            <a href="../free_choice_page/free-choice-page.html" class="btn-50"style= "top: 60px;right:14px;left: -30;">自由配<br>BYOB</a>
            <a href="../package_page/package-page.html" class="btn-50" style="top: 60px; right: 26px; left: -10px;">套餐<br>Sets</a>
            <a href="../drinks_page/drinks-page.html"class="btn-50" style="top: 60px; right: 10px; left: -10;padding-right: 12px;">飲料<br>Drinks</a>

        </div>

        <hr color="#fff" size="2"  width="100%"  style="margin-top: 150px;">  

        <h2 style="color:#fff;font-size:25px;margin-top: 10px;margin-left: 10px;">主要商品</h2>
        <main>
            <div class="carousel-container" >


                <button class="rounded-icon-btn"style="margin-top: 80px;margin-left: 80px;"onclick="window.location.href='/free_choice_page/free-choice-page.html';">
                    <div class="carousel">
                    <img src="img/f2179035b514370752e782ed7c07c6bb.png"alt="米飯圖示";>
                    <div style="margin-top: 10px; color: #fff; font-size: 25px;">自由配BYOB</div>
                    <i class="fas fa-shopping-cart"></i>
                </button>

                <button class="rounded-icon-btn" style="margin-top: 80px;margin-left: 80px;" onclick="window.location.href='/package_page/package-page.html';">
                    <img src="img/89f9fcdc19f25666916a087cf647a887.png" alt="套餐圖示">
                    <div style="margin-top: 10px; color: #fff; font-size: 25px;">套餐Sets</div>
                    <i class="fas fa-shopping-cart"></i>
                </button>

                <button class="rounded-icon-btn"style="margin-top:80px; margin-bottom: 160px;margin-left: 80px;"onclick="window.location.href='/drinks_page/drinks-page.html';">
                    <img style="width:130%;height:150px" alt="飲料圖示" src="img/black tea.png" >
                    <div style="margin-top: 0px;color: #fff;font-size: 25px;margin-bottom: 20px;">飲料drinks</div>
                    <i class="fas fa-shopping-cart"></i>
                </button>
            </div>

            <div id="menu-container" style="padding: 20px; background-color: #f9f9f9; border-radius: 8px;">
                <h2>菜單數據加載中...</h2>
            </div>


            <div class="cart-wrap">

                <div id="checkout-total">
              
                <p style="margin-top: 10px; color:#fff; font-size:25px; left: 10px; top:0px;">總金額: $<span id="product-price">120</span></p>
                <div class="button-group">  
                <button id="add-to-cart" onclick="addToCart()"style="margin-bottom:10px;margin-left: 210px;">加入購物車</button>
                <button onclick="viewCart()" style="margin-left: 210px;margin-bottom: 17px">查看購物車</button>
            </div>
            </div>

        </main>





        <div style="display: flex;">
            <!-- 背景遮罩 -->
            <div id="modal-overlay" class="modal-overlay"></div>

            <!-- 購物車模態框 -->
            <div id="cart-modal" style="display: none; left: 827px;">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('cart')">×</span>
                    <h2 style="color: #000;">購物車</h2>
                    <div id="cart-items"></div>
                    <div id="initial-amount" style="color: #000;">初始金額: $<span
                            id="initial-amount-value">120</span></div>
                    <button onclick="openCheckout()">結帳</button>
                    <button onclick="removeAllItems()">清空購物車</button>
                </div>
            </div>

               <!-- 背景遮罩 -->
               <div id="modal-overlay" class="modal-overlay"></div>

               <!-- 購物車模態框 -->
               <div id="cart-modal" style="left: 827px;">
                   <div class="modal-content" style="display: block;width: 358px;left: 438.889px;">
                       <span class="close" onclick="closeModal('cart')">×</span>
                       <h2>購物車</h2>
                       <div id="cart-items">
                           <div class="cart-item">base: 生菜</div>
                           <div class="cart-item">protein: 雞肉</div>
                           <div class="cart-item">condiment: 小黃瓜</div>
                           <div class="cart-item">sauce: 泰式酸辣醬</div>
                           <div class="cart-item">sprinkle: 海苔</div>
                       </div>
                       <button onclick="openCheckout()">結帳</button>
                       <button onclick="removeAllItems()">清空購物車</button>
                       <div id="initial-amount">初始金額: $<span id="initial-amount-value">120</span></div>
                   </div>
               </div>
   
               <!-- 結帳模態框 -->
               <div id="checkout-modal" style="left: 827px; display: none;">
                   <div class="modal-content">
                       <span class="close" onclick="closeModal('checkout')">×</span>
                       <h2>結帳</h2>
                       <div id="checkout-items">
                           <strong>base：</strong><br>
                           <div>生菜</div><br><strong>protein：</strong><br>
                           <div>鮭魚(+70)</div><br><strong>condiment：</strong><br>
                           <div>花椰菜</div><br><strong>sauce：</strong><br>
                           <div>墨西哥辣醬</div><br><strong>sprinkle：</strong><br>
                           <div>核桐麥</div><br>
                       </div>
                       <button onclick="confirmCheckout()">確認訂購</button>
                   </div>
               </div>
   
               <div id="notification"></div>

              
            </div>
    </div>


    <script>


    /**網頁載入後顯示所有已經有的訂單資料**/


     //改
        document.addEventListener('DOMContentLoaded',  async() => {    // 確保頁面 DOM 載入完畢後執行

        function renderOrders(data) {
        const orderListBody = document.querySelector("#orderListBody"); // 確保獲取正確的表格 body

        if (!orderListBody) {
            console.error("找不到訂單表格容器！");
            return;
        }

                // 清空舊的訂單資料，避免重複渲染
                orderListBody.innerHTML = '';

                    data.forEach(order => {
                        const orderRow = document.createElement('tr');
                        orderRow.innerHTML = `
                            <td>${order.customerName}</td>
                            <td>${order.customerPhone}</td>
                            <td>${order.startDateTime}</td>
                            <td>${order.endDateTime}</td>
                            <td>${order.orderStatus}</td>
                            <td>${order.menuChoices}</td>
                        `;
                        orderListBody.appendChild(orderRow);
                    });
                }

                try {
                    // 可能會出錯代碼
                } catch (error) { // 這裡這裡的 catch 现在有 try 了
        console.error('取得訂單資料失敗:', error);
     }
     
    }

    );


    //改   
          
    // 立即獲取訂單數據

      await fetchOrders();

            const carousel = document.querySelector('.carousel');
            if (!carousel){
                console.error("找不到 .carousel 元素，無法初始化滑動功能。"); 
                return;// 終止執行 
            
            }
            
            const buttonElement = document.querySelector('.rounded-icon-btn');
            const containerElement = document.querySelector('.carousel-container');

            if (!buttonElement || !containerElement) {
            console.error("無法找到必要的 DOM 元素，無法計算高度。");
            return; // 終止執行
            }
            
            
            // 確保 carousel 存在，避免報錯
 
            let currentIndex = 0;
            let startY = 0;

    // 優化查詢 DOM
            const buttonHeight = (document.querySelector('.rounded-icon-btn')?.offsetHeight || 90) + 10; 
            const visibleButtons = Math.floor((document.querySelector('.carousel-container')?.offsetHeight || 1) / buttonHeight);
            const totalButtons = document.querySelectorAll('.rounded-icon-btn').length;

            carousel.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
            });

      // 添加平滑過渡效果
            carousel.addEventListener('touchend', (e) => {
                const endY = e.changedTouches[0].clientY;
                const distance = endY - startY;
    
                if (distance < -30 && currentIndex < totalButtons - visibleButtons) {
                    currentIndex++;
                } else if (distance > 30 && currentIndex > 0) {
                    currentIndex--;
                }
    
                carousel.style.transform = `translateY(-${currentIndex * buttonHeight}px)`;
            });


        // 確保 fetchOrders 定義存在
        async function fetchOrders() {
            try {
                const response = await fetch('get-orders.php');

                if (!response.ok) {
                    throw new Error(`HTTP 錯誤！狀態碼: ${response.status}`);
                }

                const data = await response.json();

                if (!Array.isArray(data)) {
                    throw new Error("取得的訂單資料格式不正確！");
                }

                console.log("成功獲取訂單數據：", data);

                // 這裡可以繼續處理數據，例如渲染到表格
                renderOrders(data);

            } catch (error) {
                console.error("取得訂單資料失敗:", error);
            }
        }

    
        
        //改
             async (params) => {
                  
             }

        </script>

<script>
        
    // 初始價格與使用者選擇的項目
    let totalPrice = 120;
    let selectedItems = createEmptySelection();

    const maxSelections = {
    base: 1,
    protein: 1,
    condiment: 5,
    sauce: 1,
    sprinkle: 2
    };

        function createEmptySelection() {
    return {
        base: [],
        protein: [],
        condiment: [{ id: '紫薯泥', extraPrice: 20 }],
        sauce: [],
        sprinkle: []
    };
    }

    function clearCheckboxes() {
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    selectedItems = createEmptySelection();
    updatePrice();
    }

    function isChecked(optionType, choice) {
    return selectedItems[optionType].includes(choice) ? 'checked' : '';
    }

    function updateSelection(optionType, checkbox) {
   if (checkbox.checked) {
    if (selectedItems[optionType].length >= maxSelections[optionType]) {
      alert(`最多只能選擇${maxSelections[optionType]}個${optionType}`);
      checkbox.checked = false;
    } else {
      selectedItems[optionType].push(checkbox.value);
    }
    } else {
        const index = selectedItems[optionType].indexOf(checkbox.value);
        if (index > -1) selectedItems[optionType].splice(index, 1);
    }

    // 只對有額外金額的選項進行價格調整
    const extras = extraCosts[optionType].filter(ec => ec.id == checkbox.value);
    if (extras.length) {
        updatePrice();
    }
    }

    function updatePrice() {
    totalPrice = 120;
  for (const type in selectedItems) {
    selectedItems[type].forEach(item => {
      const extras = extraCosts[type].filter(ec => ec.id == item);
      if (extras.length) totalPrice += extras[0].extraPrice;
    });
  }
  document.getElementById('product-price').textContent = `${totalPrice}`;
}

    function showNotification(message = '商品已加入購物車！') {
  const note = document.getElementById('notification');
  note.innerHTML = message;
  note.style.display = 'block';
  setTimeout(() => note.style.display = 'none', 2000);
}

  function addToCart() {
  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  cart.push({
    id: cart.length + 1,
    product: structuredClone(selectedItems),
    price: totalPrice,
    amount: 1
  });
  localStorage.setItem('cart', JSON.stringify(cart));
  selectedItems = createEmptySelection();
  showNotification();
}

    function viewCart() {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  const cartDiv = document.getElementById('cart-items');

  if (!cart.length) return cartDiv.innerHTML = '還沒有加入商品';

  let content = '<div>';
  cart.forEach(item => {
    for (const key in item.product) {
      content += item.product[key].map(sub => `<div>${sub}</div>`).join('');
    }
    content += `<span class="remove-button" onclick="removeCartItem('${item.id}')">移除</span>`;
  });
  cartDiv.innerHTML = content + '</div>';
  openModal('cart');
 }

    function removeCartItem(cartId) {
     let cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart = cart.filter(item => item.id != cartId);
    localStorage.setItem('cart', JSON.stringify(cart));
    viewCart();
 }

    function removeItem(type, item) {
  const index = selectedItems[type].indexOf(item);
  if (index > -1) selectedItems[type].splice(index, 1);
  viewCart();
}

    function removeAllItems() {
  selectedItems = createEmptySelection();
  viewCart();
}

    function openCheckout() {
  const checkoutDiv = document.getElementById('checkout-items');
  checkoutDiv.innerHTML = '';
     for (const type in selectedItems) {
     if (selectedItems[type].length > 0) {
      const list = selectedItems[type].map(i => `<div>${i}</div>`).join('');
      checkoutDiv.innerHTML += `<strong>${type}：</strong><br>${list}<br>`;
    }
   }
     openModal('checkout');
 }

    function confirmCheckout() {
  alert('結帳成功！');
  removeAllItems();
  closeModal('cart');
  closeModal('checkout');
}

    function openModal(id) {
    document.getElementById(id + '-modal').style.display = 'block';
  }

    function closeModal(id) {
    document.getElementById(id + '-modal').style.display = 'none';
   }

    ocument.querySelectorAll('.option-container').forEach(option => {
     option.addEventListener('click', function () {
    document.querySelectorAll('.option-container').forEach(i => i.classList.remove('active'));
    this.classList.add('active');
    const radio = this.querySelector('input[type="radio"]');
    if (radio) radio.checked = true;
  });
   });

    async function fetchSalesData() {
    try {
    const res = await fetch('get-sales.php');
    if (!res.ok) throw new Error('Network response was not ok');
    const data = await res.json();
    document.getElementById('total-sales').textContent = `Total Sales: $${data.sales}`;
  } catch (err) {
    console.error('Error fetching sales data:', err);
  }
}

    async function fetchMenuData() {
  try {
    const res = await fetch('http://120.96.63.237/ouo/get-menu-data.php');
    if (!res.ok) throw new Error('網絡響應不是 OK');
    const data = await res.json();
    displayMenuData(data);
  } catch (err) {
    console.error('獲取菜單數據時發生錯誤:', err);
    document.getElementById('menu-container').innerHTML = '<p style="color:red;">無法加載菜單數據</p>';
  }
}

    function displayMenuData(data) {
    const container = document.getElementById('menu-container');
    container.innerHTML = '';
    data.SetMeals.forEach(menu => {
    const item = document.createElement('div');
    item.className = 'menu-item';
    item.innerHTML = `
      <h2>${menu.MenuName}</h2>
      <img src="${menu.Image}" alt="${menu.MenuName}">
      <p>價格: ${menu.Price} 元</p>
      <p>蛋白質: ${menu.ProteinChoices.join(', ')}</p>
      <p>配菜: ${menu.SideChoices.join(', ')}</p>
      <p>醬料: ${menu.SauceChoices.join(', ')}</p>
      <p>灑料: ${menu.SprinkleChoices.join(', ')}</p>
      <button onclick="addToCart('${menu.MenuName}', ${menu.Price})">加入購物車</button>
    `;
    container.appendChild(item);
  });
}

    document.addEventListener('DOMContentLoaded', fetchMenuData);
        
        // 加入購物車
        function addToCart(name, price) {
            alert(`已將 "${name}" (${price} 元) 加入購物車！`);
        }

        
    
    
        //购物车的删除、结账流程、模态框的打开和关闭，以及单选项的选择效果
    
            function removeCartItem(cartId) {    //removeCartItem 用于从购物车中移除指定的商品
                console.log(cartId)              // console.log 输出信息
                let cart = [];
                console.log(localStorage.getItem('cart'))  // getItem 浏览器的存储中获取指定键的值
                if (localStorage.getItem('cart')){
                    cart = JSON.parse(localStorage.getItem('cart'))   //JSON.parse 转化为 JavaScript 
                }
                cart = cart.filter(item=>item.id != cartId);       //filter 允许你根据条件筛选出符合条件的元素，
                localStorage.setItem('cart', JSON.stringify(cart));
    
            }
            function removeItem(type, item) {   //  removeIte删除特定类型的选项    //  type  操作的商品类别 // item 移除的商品项
                if (index > -1) {               //查找 item 位置   //找不到则返回 -1
                    selectedItems[type].splice(index, 1);
                }
                viewCart();
            }
            // removeAllItems 清空所有选项
            function removeAllItems() {                         
                for (const type in selectedItems) {
                    selectedItems[type] = [];
                }
                viewCart();
            }
        
            function openCheckout() {   //openCheckout  生成结账页面的内容，展示所有已选商品，并打开结账窗口
                const checkoutItemsDiv = document.getElementById('checkout-items');
                checkoutItemsDiv.innerHTML = '';
                for (const type in selectedItems) {
                    if (selectedItems[type].length > 0) {
                        const items = selectedItems[type].map(item => `<div>${item}</div>`).join('');
                        checkoutItemsDiv.innerHTML += `<strong>${type}：</strong><br>${items}<br>`;
                    }
                }
                openModal('checkout');
            }
    
            function confirmCheckout() {   // confirmCheckout 处理结账确认，完成后清空购物车并关闭视窗
                alert('結帳成功！');
                removeAllItems();
                closeModal('cart'); // 關閉購物車視窗
                closeModal('checkout'); // 關閉結帳視窗
            }
    
            function openModal(modalId) { 
                const modal = document.getElementById(modalId + '-modal');
                modal.style.display = 'block';
            } 
                                                                            /// openModal
            function closeModal(modalId) {                                               //打开和关闭模态框
                const modal = document.getElementById(modalId + '-modal');  // closeModal
                modal.style.display = 'none';
            }
            document.querySelectorAll('.option-container').forEach(option => {  // querySelectorAll 批量操作
                option.addEventListener('click', function () {                  // ption-container 单选选项点击事件监听
                    // Remove 'active' class from all options
                    document.querySelectorAll('.option-container').forEach(item => item.classList.remove('active'));
    
                    // Add 'active' class to the clicked option
                    this.classList.add('active');
    
                    // Select the radio input inside the clicked option
                    const radioInput = this.querySelector('input[type="radio"]');
                    if (radioInput) {
                        radioInput.checked = true;
                    }
                });
            });
    
            // Send order to PHP backend (submit-order.php)
            async function submitOrder() {
            const orderData = {
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                startTime: document.getElementById('startDateTime').value,
                endTime: document.getElementById('endDateTime').value,
                status: document.getElementById('orderStatus').value,
                menuItems: getSelectedMenuItems()
            };
    
            if (!validateOrderData(orderData)) {
                alert('請填寫所有必需的字段');
                return;
            }
    
            try {
                const response = await fetch('submit-order.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
    
                const result = await response.json();
                
                if (result.success) {
                    alert('訂單提交成功！');
                    clearForm();
                    loadOrders();
                } else {
                    alert('訂單提交失敗：' + result.message);
                }
            } catch (error) {
                console.error('提交訂單時發生錯誤：', error);
                alert('提交訂單時發生錯誤，請稍後重試');
            }
        }
                
   
      const menuItems = [
        {
            "MenuName": "套餐 A",
            "Image": "img/menu-a.jpg",
            "Price": 120,
            "ProteinChoices": ["雞肉", "牛肉"],
            "SideChoices": ["花椰菜", "胡蘿蔔"],
            "SauceChoices": ["泰式醬", "黑胡椒醬"],
            "SprinkleChoices": ["花生碎", "芝麻"]
        },

        {
            "MenuName": "套餐 B",
            "Image": "img/menu-b.jpg",
            "Price": 150,
            "ProteinChoices": ["魚肉", "豆腐"],
            "SideChoices": ["玉米", "蘆筍"],
            "SauceChoices": ["番茄醬", "蜂蜜芥末醬"],
            "SprinkleChoices": ["洋蔥碎", "辣椒粉"]
        }
        
        ];
 

        function getSelectedMenuItems() {
        // 假設通過某些選項來獲取用戶選擇的菜單項目
         return menuItems.filter(item => item.MenuName === "套餐 A"); // 示例邏輯
        }

    </script>

      </script>

</body>


</html>